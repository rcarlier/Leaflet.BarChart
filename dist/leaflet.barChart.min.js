L.BarChart=L.LayerGroup.extend({initialize:function(t,o){if(null===t)throw new Error("Invalid data");if(!Array.isArray(t)){if("object"!=typeof t)throw new Error("Data must be an array or an object");t=[t]}let i;if(!t[0]||!t[0].values)throw new Error("Invalid data: all data point must have values");i=t[0].values.length;for(let o=0;o<t.length;o++){var l=t[o],e=l.values;if(!Array.isArray(e)||0===e.length)throw console.log(l),new Error("Invalid values for data point ");if(e.length!==i)throw console.log(l),new Error("Different number of values ");if(void 0!==l.label&&(Array.isArray(l.label)||"object"==typeof l.label))throw console.log(l),new Error("Invalid label");if(void 0===l.lat||void 0===l.lng&&void 0===l.lon)throw console.log(l),new Error("Missing latitude or longitude");void 0!==l.lon&&(l.lng=l.lon,delete l.lon)}if(this._data=t,void 0!==o.colors){if(!Array.isArray(o.colors))throw console.log(o.colors),new Error("Invalid colors option");if(2<=o.colors.length)if(new Set(o.colors).size!==o.colors.length)throw console.log(o.colors),new Error("Colors option contains duplicate values")}if(void 0!==o.width&&"number"!=typeof o.width)throw console.log(o.width),new Error("Invalid width option");if(void 0!==o.height&&"number"!=typeof o.height)throw console.log(o.height),new Error("Invalid height option");if(void 0!==o.zoom&&"number"!=typeof o.zoom)throw console.log(o.zoom),new Error("Invalid zoom option");if(void 0!==o.fillOpacity&&"number"!=typeof o.fillOpacity)throw console.log(o.fillOpacity),new Error("Invalid fillOpacity option");if(void 0!==o.unitDecimal&&"number"!=typeof o.unitDecimal)throw console.log(o.unitDecimal),new Error("Invalid unitDecimal option");if(void 0!==o.unitZerofill&&"number"!=typeof o.unitZerofill)throw console.log(o.unitZerofill),new Error("Invalid unitZerofill option");if(void 0!==o.legend&&(!Array.isArray(o.legend)||o.legend.length!==i))throw console.log(o.legend),new Error("Invalid legend option");if(void 0!==o.legendPos){var n=["bottomleft","bottomright","topleft","topright"];if(!n.includes(o.legendPos))throw console.log(o.legendPos),console.log("Must be:",n),new Error("Invalid legendPos option")}if(void 0!==o.showLegend&&"boolean"!=typeof o.showLegend)throw console.log(o.showLegend),new Error("Invalid showLegend option");if(void 0!==o.showLegendInPopup&&"boolean"!=typeof o.showLegendInPopup)throw console.log(o.showLegendInPopup),new Error("Invalid showLegendInPopup option");if(void 0!==o.unitPos){n=["after","before"];if(!n.includes(o.unitPos))throw console.log(o.unitPos),console.log("Must be:",n),new Error("Invalid unitPos option")}if(void 0!==o.title&&(Array.isArray(o.title)||"object"==typeof o.title))throw console.log(o.title),new Error("Invalid title option");if(void 0!==o.subTitle&&(Array.isArray(o.subTitle)||"object"==typeof o.subTitle))throw console.log(o.subTitle),new Error("Invalid subTitle option");if(void 0!==o.unit&&(Array.isArray(o.unit)||"object"==typeof o.unit))throw console.log(o.unit),new Error("Invalid unit option");for(this._opt=o||{},this._opt.width=this._opt.width||.3,this._opt.height=this._opt.height||.5,this._opt.zoom=this._opt.zoom||null,this._opt.fillOpacity=this._opt.fillOpacity||.75,this._opt.colors=this._opt.colors||["#1F77B4","#FF7F0E","#2CA02C","#D62728","#9467BD","#8C564B","#E377C2","#7F7F7F","#BCBD22","#17BECF"];this._opt.colors.length<i;)this._opt.colors=this._opt.colors.concat(this._opt.colors);this._opt.legend=this._opt.legend||Array(i).fill(""),this._opt.legendPos=this._opt.legendPos||"topright",this._opt.title=this._opt.title||"",this._opt.subTitle=this._opt.subTitle||"",null==this._opt.showLegend&&(this._opt.showLegend=!0),null==this._opt.showLegendInPopup&&(this._opt.showLegendInPopup=!1),this._opt.unit=this._opt.unit||"",this._opt.unitPos=this._opt.unitPos||"after",this._opt.unitDecimal=this._opt.unitDecimal||null,this._opt.unitZerofill=this._opt.unitZerofill||null,L.LayerGroup.prototype.initialize.call(this)},onAdd:function(o){this._map=o,this._drawHistograms(),this._addLegend(),L.LayerGroup.prototype.onAdd.call(this,o)},_formatNumber:function(o,t={}){var{unitDecimal:t=null,unitZerofill:i=null}=t,l=1.1.toLocaleString().substring(1,2);let[e,n]=o.toString().split("."),r=(null!==i&&(e=e.padStart(i,"0")),null!==t&&(n=n?n.slice(0,t).padEnd(t,"0"):"0".repeat(t)),e);return void 0!==n&&(r+=l+n),r},_drawHistograms:function(){var t=this._data,r=this._opt;for(let o=0;o<t.length;o++){let l=0;var s=t[o],a=s.values;let e=s.lat,n="";s.label&&(n+=`<strong>${s.label}</strong><br>`);for(let i=0;i<a.length;i++){let o;o=null!==r.zoom?a[i]*r.zoom:a[i]/100*r.height,L.rectangle([[e,s.lng],[e+o,s.lng+r.width]],{color:r.colors[i],weight:.5,color:r.colors[i],fillColor:r.colors[i],fillOpacity:r.fillOpacity}).addTo(this),l+=o,e+=o;var h=a[a.length-i-1],h=this._formatNumber(h,r),d="background-color: "+r.colors[a.length-i-1];let t="";t="before"==r.unitPos?` ${r.unit} `+h:` ${h} `+r.unit,!0===r.showLegendInPopup&&(t+=`&nbsp;<small>${r.legend[a.length-i-1]}</small>`),n+=`<div class="lBarLigne">
                    <span class="lBarSquare" style="${d}"></span>
                    ${t}
                </div>`}L.rectangle([[s.lat,s.lng],[s.lat+l,s.lng+r.width]],{weight:1,color:"#000",fillColor:"transparent"}).addTo(this).on("click",function(o){L.popup().setLatLng(o.latlng).setContent(n).openOn(this._map)})}},_addLegend:function(){let i=this._opt;if(!0!==i.showLegend&&""===i.title&&""===i.subTitle)return null;let l=i.legend,e=i.colors;var o=i.legendPos,o=L.control({position:o});o.onAdd=function(o){var t=L.DomUtil.create("div","info lBarLegend");if((t.innerHTML="")!==i.title&&(t.innerHTML+=`<div class="lBarTitle">${i.title}</div>`),""!==i.subTitle&&(t.innerHTML+=`<div class="lBarSubTitle">${i.subTitle}</div>`),!0===i.showLegend)for(let o=l.length-1;0<=o;o--)t.innerHTML+=`<div class="lBarLigne">
                <span class="lBarSquare" style="background-color: ${e[o]}; "></span>
                ${l[o]}
                </div>`;return t},o.addTo(this._map)}}),L.barChart=function(o,t={}){return new L.BarChart(o,t)};